% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/socmob.R
\name{socmob}
\alias{socmob}
\title{Estimating social mobility effect (full bootstrap over conditionaleffect & pips)}
\usage{
socmob(
  data,
  y,
  o,
  d,
  x,
  estimator = "Lrnr_glm",
  custom.pips = NULL,
  custom.table = NULL,
  strength = NULL,
  contrast = NULL,
  boot_reps = 200
)
}
\arguments{
\item{data}{A dataframe}

\item{y}{The outcome variable (string)}

\item{o}{The origin variable (string)}

\item{d}{The destination/treatment variable (string)}

\item{x}{A character vector of additional control variables (confounders)}

\item{estimator}{A learner name or vector of learner names from sl3 (default "Lrnr_glm")}

\item{custom.pips}{Optionally, a dataframe of post-intervention propensities (columns = treatment levels)}

\item{custom.table}{A matrix/table for the post-intervention scenario (rows = origin, columns = destination)}

\item{strength}{A numeric \eqn{\in [0,1]} specifying the log-odds ratio change in \code{\link{stepstable}}}

\item{contrast}{A table specifying odds ratios to form a new interventional scenario via \code{\link{contrasttable}}}

\item{boot_reps}{The number of external bootstrap repetitions for final mobility effect SE. Default 200.}
}
\value{
A named list with:
\item{predicted_outcomes}{Dataframe of predicted outcomes (from full data, boot_reps=1 in conditionaleffect)}
\item{pips_observed}{Observed (pre-intervention) propensity from pips(..., strength=0)}
\item{pips_post}{Post-intervention propensity (computed or user-supplied)}
\item{observed_outcome}{Model-based observed outcome = sum of predicted outcomes * pips_observed}
\item{post_outcome}{Post-intervention outcome = sum of predicted outcomes * pips_post}
\item{mobility_effect}{Overall effect (overall, gainer, giver) + boot SE}
\item{origin_specific}{By-origin difference (pre vs. post) + boot SE}
\item{destination_specific}{By-destination difference (pre vs. post) + boot SE}
}
\description{
This function:
\enumerate{
\item Calls \code{\link{conditionaleffect}} on the full data (with \code{boot_reps = 1}) to get a baseline predicted outcome structure.
\item Uses \code{pips(..., strength=0)} to compute the model-based "observed" distribution (and outcome).
\item Uses user-supplied or newly computed \code{pips(...)} for the post-intervention distribution.
\item Computes the difference in outcomes (post - observed) across individuals.
\item Runs a bootstrap of size \code{boot_reps} that re-fits the outcome model (conditionaleffect) and re-computes pips for each replicate:
\itemize{
\item i.e., for each replicate we do:
(a) sample data with replacement,
(b) conditionaleffect(boot_data, ..., boot_reps=1),
(c) pips(boot_data),
(d) compute observed & post-outcomes,
(e) compute overall/gainer/giver + by-origin/destination.
}
}

The final standard errors for all mobility effects are derived from that external bootstrap.
}
\examples{
\dontrun{
result <- socmob(
  data     = toy_data,
  y        = "child_outcome",
  o        = "origin_var",
  d        = "treatment_var",
  x        = c("confound1","confound2"),
  strength = 1,
  boot_reps= 200
)
}
}
